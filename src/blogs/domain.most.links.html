
    <div style="padding:0 10px;"><p style="line-height:" 2em;=""><span style="font-family:微软雅黑," microsoft="" yahei="">&nbsp;&nbsp;&nbsp;&nbsp;你知道浏览器对于同一域名的最大请求连接限制吗? 不知道, 木关系, 其实之前我也不太清楚.</span></p>
        <p style="line-height:" 2em;=""><span style="font-family:微软雅黑," microsoft="" yahei="">&nbsp;&nbsp;&nbsp;&nbsp;你知道如何针对这一限制提升web应用性能吗? 不知道, 木关系, 过早的优化是<span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 32px;="">魔鬼</span></span></p>
        <p style="line-height:" 2em;=""><span style="font-family:微软雅黑," microsoft="" yahei="">&nbsp;&nbsp;&nbsp;&nbsp;但是, 既然这样我要推荐一篇我最近很喜欢的文章(已翻译, 放心是我人工翻译, 不是机器翻译), 作者是一位拥有多年web开发经验的老鸟, 讲述对于这一浏览器限制的常见<span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 32px;="">前端</span>问题与解决方案. 下图是主流浏览器对于这一规则的上限.</span></p>
        <p style="line-height:" 2em;=""><span style="font-family:微软雅黑," microsoft="" yahei=""><img src="http://nigeerhuo-public.oss-cn-shanghai.aliyuncs.com/images/ueditor/php/upload/image/20151111/1447246936140683.gif" title="1447246936140683.gif" alt="QQ图片20151111203647.gif"></span></p>
        <p style="line-height:" normal;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 12px;="" color:="" rgb(147,="" 137,="" 83);="" background-color:="" rgb(255,="" 255,="" 255);="">(图片来源 :&nbsp;<span style="color:" rgb(147,="" 137,="" 83);="" font-size:="" 12px;="" font-family:="" verdana,="" arial,="" helvetica,="" sans-serif;="" line-height:="" 18px;="">PROFESSIONAL Website Performance: OPTIMIZING THE FRONT END AND THE BACK END by Peter Smith&nbsp;</span>)</span></p></div>

    <a href="javascript:;" class="show-detail">
        <span class="d-info">Show Detail</span>
        <span class="icon glyphicon glyphicon-play-circle"></span>
    </a>
		<span class="content" style="display:none;">
			<p><span style="line-height:" 21px;="" widows:="" auto;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" color:="" rgb(38,="" 38,="" 38);="" background-color:="" rgb(255,="" 255,="" 255);="">如果我告诉你浏览器在同一domain下发送请求的数量有上限, 你是否会惊讶?</span><img src="http://localhost/Github/MyBlog/web/ueditor/themes/default/images/spacer.gif" modifysize="100%" diffpixels="24px" scalingmode="zoom" word_img="file:///C:/Users/ajax/Documents/Tencent%20Files/735267452/MyCollection/Image/C03DF098-2A76-4796-83EE-A5259A7EB95D.png" style="line-height:" 2em;="" border:="" 1px="" solid="" rgb(221,="" 221,="" 221);="" background-image:="" url(http:="" localhost="" github="" myblog="" web="" ueditor="" lang="" zh-cn="" images="" localimage.png);="" background-attachment:="" initial;="" background-size:="" background-origin:="" background-clip:="" background-position:="" 50%="" 50%;="" background-repeat:="" no-repeat;=""><br></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><strong><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="">The limit(这一限制)</span></strong></span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;如果你没听说过这条规则, 请别太惊讶. 因为我看到许多开发者都忽略了这个重要的事情.&nbsp;</span></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><strong><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="">那么为什么浏览器有这一限制?</span></strong></span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;你可能要问这条限制难道不会对性能有负面影响吗? 如果浏览器给更多的连接, 我们不就有更好的上网体验了吗? &nbsp; 其实浏览器这样做的原因是担心服务器过载. 在过去, 这个同domain并发请求上限普遍仅仅只有2个, 但那是web的早期, 而且是完全足够的. 因为那时候网页内容加载完成时(DomReady), 大部分内容就已经加载好了, 想想看, 图片都是稀缺资源啊!&nbsp;</span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;然而, 当css, js 变得越来越流行的时候, 这个限制很快就到了瓶颈. 因为这个原因, 我们可以看到在现在的浏览器中, 这个上限值在不断增加. 某些浏览器, 比如说Opera, 甚至允许你修改这个值, 但你最好不要设置太高, 除非你是个开发者在做测试, 否则服务器可能认为你在攻击它. (DDOS 攻击)</span></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><strong><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="">这一限制的影响</span></strong></span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;这一限制会怎样影响你的网页呢 ? 原因很多, 除非你让用户加载一个木有图片, css 与js的静态网页, 否则所有的资源都要在<span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" normal;="">加载队列</span><span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 1.5;="">排队, 等着浏览器说 hey, 你可以加载了!. &nbsp;如果你的网页中某些资源依赖其它资源先加载好, 那么你就会觉察到看这一限制对网页加载时间有影响.</span></span></p>
    <p style="line-height:" 2em;=""><span style="line-height:" 1.5;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);=""><br></span></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><strong><span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 1.5;="">如何对待这一限制?</span></strong><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;=""><span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 1.5;=""><br></span><span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" normal;="">&nbsp;&nbsp;&nbsp;&nbsp;如果你把资源管理的很好, 那</span><span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 1.5;="">这一限制并不会使你的网站变慢. 当你的网页第一次加载的时候, 第一个请求就是HTML文本, 当浏览器解析这个文本时, 就产生了相应的css, images与 js 请求. 当浏览器开始执行js的时候, 它还可能发送ajax请求到服务端. (译者注 : 浏览器解析css的时候还可能加载背景图, 自定义字体等资源)</span></span></span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);=""><span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 1.5;="">&nbsp;&nbsp;&nbsp;&nbsp;幸运的是静态资源只在第一次请求时下载并缓存在浏览器中, 后续对该静态资源的请求(包括关闭网页再打开这样的操作)都会直接从缓存中获取. (译者注 : 这里, 浏览器的处理方式并不是这么简单, 浏览器还要判断资源的过期时间expires等等一系列操作来确定确实可以从缓存中获取该资源) . &nbsp;如果你觉得某些资源过于零碎并且要求太多的连接请求, 那我推荐一些工具给你&nbsp;</span><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" verdana,="" arial,="" helvetica,="" sans-serif;="" font-size:="" 12px;="" line-height:="" normal;="" background-color:="" rgb(240,="" 230,="" 213);="">(UglifyJS, Rhino, YUI Compressor, ...)&nbsp;</span><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑;="" font-size:="" 12px;="" line-height:="" 1.5;="" outline:="" none;="">它们可以帮你把碎片资源整合成一个文件以减少浏览器请求数目.</span></span></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><em><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" text-decoration:="" none;="">对Ajax这一技术<strong>不好的实践</strong>往往也会带来很严峻的问题, 比如下面所列三条 :</span></em></span></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><strong><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="">1. 太多ajax请求</span></strong></span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;也许你认为这个问题很简单, 那我说说几年前我接手的一个项目.</span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;这个项目遇到很大的性能问题, 有很多因素其中有一条重要的原因就是太多的ajax请求. 而且这个问题还在加剧, 因为这个项目是来自不同洲, 不同时区的团队共同完成的. 使用Ajax请求可以很好的处理我们这样的并行开发与团队编程,</span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;但是我担心这样的现状会让ajax请求数量失去控制, 所以我决定调整一下开发的方向, 原先的设计如下图:</span></p>
    <p style="line-height:" 2em;=""><img src="http://localhost/Github/MyBlog/web/ueditor/themes/default/images/spacer.gif" modifysize="100%" diffpixels="24px" scalingmode="zoom" style="background:url(http://localhost/Github/MyBlog/web/ueditor/lang/zh-cn/images/localimage.png)" no-repeat="" center="" center;border:1px="" solid="" #ddd="" word_img="file:///C:/Users/ajax/Documents/Tencent%20Files/735267452/MyCollection/Image/AC5C2F42-58F8-4B43-B83D-1A8454D8114C.png"><img src="http://nigeerhuo-public.oss-cn-shanghai.aliyuncs.com/images/ueditor/php/upload/image/20151111/1447245636106069.png" title="1447245636106069.png" alt="QQ图片20151111203713.png" style="float:" right;=""><br></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;对于多数Ajax请求, 我们返回json格式的数据, 然后再把html与model(数据)绑定.虽然我们木有遇到嵌套请求的问题, 但由于完成一个单独的页面有太多的ajax请求并且加上浏览器的请求限制, 我们没办法使项目更快! 还有一个问题就是缺少缓存处理.&nbsp;</span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;深思熟虑后, 我们决定把减少一个页面的ajax请求数量.我们使用了异步编程(<span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" verdana,="" arial,="" helvetica,="" sans-serif;="" font-size:="" 12px;="" line-height:="" normal;="" background-color:="" rgb(240,="" 230,="" 213);="">Aysnc Programming</span><span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 1.5;="">)</span></span></p>
    <p style="line-height:" 2em;=""><img src="http://localhost/Github/MyBlog/web/ueditor/themes/default/images/spacer.gif" modifysize="100%" diffpixels="24px" scalingmode="zoom" style="background:url(http://localhost/Github/MyBlog/web/ueditor/lang/zh-cn/images/localimage.png)" no-repeat="" center="" center;border:1px="" solid="" #ddd="" word_img="file:///C:/Users/ajax/Documents/Tencent%20Files/735267452/MyCollection/Image/5B0F7250-6B68-4B2D-8626-3A57970388CB.png"><img src="http://localhost/ueditor/php/upload/image/20151111/1447245689121543.png" title="1447245689121543.png" alt="QQ图片20151111203717.png" style="line-height:" 32px;="" white-space:="" normal;=""></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;每一个 promise 在一个独立的线程中执行(不是http线程), 只有所有promises都完成的时候才发送响应给浏览器. (译者注 : 这里作者使用的是服务端技术, 可以简单的理解成 : 作者在服务端加了一个中间程序处理ajax请求, 前端把需要的ajax请求写在一个请求中然后发给服务端, 服务端处理这单个请求中所有需要的服务然后返回给前端) (该优化属于服务端的范畴) (另外作者这里所说的<span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" normal;="">异步编程</span><span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 1.5;="">是指在服务端代码中使用了一些异步编程的语法, 并不是说图上的方案叫异步编程)</span></span></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><strong><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="">2. 没有很好地处理请求队列</span></strong></span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;如果你用js发送一个ajax请求但是浏览器木有更多可用连接来处理该请求, 那么这个请求就会加入请求队列 (我叫它 排队). 这种情况往往发生在一个富web网页. 富web网页更像一个应用, 而不是传统理解的简单静态网页.</span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;假设我有一个搜索框, 用户只要改变了其中的值就发送一个ajax请求, 就叫它即时搜索好了. 如果用户改变过于频繁, 那么js就会短时间发送大量的ajax请求.</span></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="">&nbsp;&nbsp;&nbsp;&nbsp;解决方法很简单. A. 忘了什么富web网页吧, 老老实实用刷新页面的方式呈现给用户 &nbsp;B.设置请求间隔, 或者在上一个请求完成后再发送另一个请求.&nbsp;</span><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 2em;="">&nbsp;(译者注 : 推荐使用B. 类似的还有点击button提交表单, 当用户点击提交按钮后, 事件A触发, 在A完成之前, 我们应该阻止A的再次触发, 可以给button变为灰色, 并且提示用户表单正在提交中, 这些都是很好的用户体验与编程实践)</span></span></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><strong><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="">3. 嵌套的ajax请求</span></strong></span></p>
    <p style="line-height:" 2em;=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="" color:="" rgb(38,="" 38,="" 38);="">&nbsp;&nbsp;&nbsp;&nbsp;什么是嵌套的ajax 请求 ? 例如我需要所有国家的国旗, 并以洲排序. 我先发一个请求获取所有的大洲, 然后依次获取每个大洲所有国家的国旗.&nbsp;</span></p>
    <p style="line-height:" 2em;=""><span style="color:" rgb(38,="" 38,="" 38);=""><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" font-size:="" 16px;="">&nbsp;&nbsp;&nbsp;&nbsp;假设有5个洲, 那么一共发送了 &nbsp;1 + 5 = 6 个请求, 这是木有必要的, 因为你可以在服务端按洲排序<span style="color:" rgb(12,="" 12,="" 12);="" font-size:="" 16px;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" normal;="">所有国家的国旗, 然后一次返回给前端.&nbsp;</span></span><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" 1.5;="">(译者注 : 这个道理看上去大家都懂, 往往却犯了这样的错误, 问题是往往还不容易发现, 因为它毕竟不是语法错误. 我就做过这样的事. 所以要牢记心中)</span><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" normal;="">.</span></span></p>
    <p style="line-height:" 2em;=""><a href="http://sgdev-blog.blogspot.sg/2014/01/maximum-concurrent-connection-to-same.html" target="_blank" style="text-decoration:" underline;="" font-family:="" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" normal;="" color:="" rgb(38,="" 38,="" 38);=""><span style="font-family:" 微软雅黑,="" 'microsoft="" yahei';="" line-height:="" normal;="" color:="" rgb(38,="" 38,="" 38);="">原英文地址</span></a></p>
    <p style="line-height:" 2em;="" text-align:="" center;=""><span style="font-family:" 'arial="" black',="" 'avant="" garde';="" color:="" rgb(38,="" 38,="" 38);=""><em><span style="color:" rgb(12,="" 12,="" 12);="" font-family:="" 'arial="" black',="" 'avant="" garde';="" line-height:="" 1.5;="" font-size:="" 16px;="">---END---</span></em></span></p>
    </span>

